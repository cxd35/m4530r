/*
 * This program is copyright ï¿½ 2008,2009 Eric Bishop and is distributed under the terms of the GNU GPL 
 * version 2.0 with a special clarification/exception that permits adapting the program to 
 * configure proprietary "back end" software provided that all modifications to the web interface
 * itself remain covered by the GPL. 
 * See http://gargoyle-router.com/faq.html#qfoss for more information
 */function reboot(){setControlsEnabled(!1,!0,"System Is Now Rebooting");var a="\nsh /usr/lib/gargoyle/reboot.sh\n",b=getParameterDefinition("commands",a)+"&"+getParameterDefinition("hash",document.cookie.replace(/^.*hash=/,"").replace(/[\t ;]+.*$/,"")),c=function(a){a.readyState!=4};runAjax("POST","utility/run_commands.sh",b,c),currentProtocol=location.href.match(/^https:/)?"https":"http",testLocation=currentProtocol+"://"+window.location.host+"/utility/reboot_test.sh",testReboot=function(){toggleReload=!0,setTimeout("testReboot()",5e3),document.getElementById("reboot_test").src=testLocation},setTimeout("testReboot()",25e3),setTimeout("reloadPage()",24e4)}function reloadPage(){if(toggleReload){var a=document.getElementById("reboot_test").readyState;if(typeof a=="undefined"||a==null||a=="complete")toggleReload=!1,document.getElementById("reboot_test").src="",window.location.href=window.location.href}}function saveChanges(){setControlsEnabled(!1,!0);if(getSelectedValue("sched_reboot")!="none"){var a=getSelectedValue("reboot_interval"),b=getSelectedValue("reboot_day"),c=getSelectedValue("reboot_hour"),d=a=="week"?b:"*",e=a=="month"?b:"*";cronLine="0 "+c+" "+e+" * "+d+" sh /usr/lib/gargoyle/reboot.sh"}else cronLine="";var f=[];f.push("mkdir -p /etc/crontabs"),f.push("touch /etc/crontabs/root"),f.push('cat /etc/crontabs/root | grep -v "usr\\/lib\\/gargoyle\\/reboot.sh" > /tmp/tmp.cron'),cronLine!=""&&f.push("echo '"+cronLine+"' >>/tmp/tmp.cron"),f.push("mv /tmp/tmp.cron /etc/crontabs/root"),f.push("/etc/init.d/cron restart");var g=getParameterDefinition("commands",f.join("\n"))+"&"+getParameterDefinition("hash",document.cookie.replace(/^.*hash=/,"").replace(/[\t ;]+.*$/,"")),h=function(a){a.readyState==4&&setControlsEnabled(!0)};runAjax("POST","utility/run_commands.sh",g,h)}function resetData(){var a=cronLine.split(/[\t ]+/);if(a.length>4){var b=parseInt(a[1])+"",c=parseInt(a[4])+"",d=parseInt(a[2])+"",e="";b=b=="NaN"?"0":b,c=c=="NaN"?"*":c,d=d=="NaN"?"*":d,e=c!="*"?c:e,e=d!="*"?d:e;var f=c=="*"&&d=="*"?"hour":"";f=c!="*"&&d=="*"?"week":f,f=c=="*"&&d!="*"?"month":f,setSelectedValue("sched_reboot","scheduled"),setSelectedValue("reboot_interval",f),setVisibility(),setSelectedValue("reboot_hour",b),setSelectedValue("reboot_day",e)}else setSelectedValue("sched_reboot","none"),setVisibility()}function setVisibility(){var a=getSelectedValue("reboot_interval");if(a=="month"){var b=[],c=[],d=1;for(d=1;d<=28;d++){var e=""+d,f=e.substr(e.length-1,1),g="th";d%100!=11&&f=="1"&&(g="st"),d%100!=12&&f=="2"&&(g="nd"),d%100!=13&&f=="3"&&(g="rd"),c.push(e+g),b.push(d-1+"")}setAllowableSelections("reboot_day",b,c)}else if(a=="week"){var c=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],b=[],h;for(h=0;h<7;h++)b.push(h+"");setAllowableSelections("reboot_day",b,c)}setInvisibleIfIdMatches("reboot_interval",["day"],"reboot_day_container"),setInvisibleIfIdMatches("sched_reboot",["none"],"schedule_reboot_container")}var toggleReload=!1;