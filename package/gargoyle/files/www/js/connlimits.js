/*
 * This program is copyright ï¿½ 2008 Eric Bishop and is distributed under the terms of the GNU GPL 
 * version 2.0 with a special clarification/exception that permits adapting the program to 
 * configure proprietary "back end" software provided that all modifications to the web interface
 * itself remain covered by the GPL. 
 * See http://gargoyle-router.com/faq.html#qfoss for more information
 */function saveChanges(){var a=proofreadAll();if(a.length>0)errorString=a.join("\n")+"\n\nChanges could not be applied.",alert(errorString);else{setControlsEnabled(!1,!0),maxConnections=document.getElementById("max_connections").value,tcpTimeout=document.getElementById("tcp_timeout").value,udpTimeout=document.getElementById("udp_timeout").value;var b=[];b.push("cp /etc/sysctl.conf /tmp/sysctl.conf.tmp.1");var c=function(a,c,d){var e=c.replace(/^.*\./g,"");b.push("echo "+d+" > "+a),b.push('cat /tmp/sysctl.conf.tmp.1 | grep -v "^'+c+'=" > /tmp/sysctl.conf.tmp.2'),b.push('echo "'+c+"="+d+'" >> /tmp/sysctl.conf.tmp.2'),b.push("mv /tmp/sysctl.conf.tmp.2 /tmp/sysctl.conf.tmp.1")};c("/proc/sys/net/netfilter/nf_conntrack_max","net.netfilter.nf_conntrack_max",maxConnections),c("/proc/sys/net/netfilter/nf_conntrack_tcp_timeout_established","net.netfilter.nf_conntrack_tcp_timeout_established",tcpTimeout),c("/proc/sys/net/netfilter/nf_conntrack_udp_timeout_stream","net.netfilter.nf_conntrack_udp_timeout_stream",udpTimeout),b.push("mv /tmp/sysctl.conf.tmp.1 /etc/sysctl.conf");var d=getParameterDefinition("commands",b.join("\n"))+"&"+getParameterDefinition("hash",document.cookie.replace(/^.*hash=/,"").replace(/[\t ;]+.*$/,"")),e=function(a){a.readyState==4&&(resetData(),setControlsEnabled(!0))};runAjax("POST","utility/run_commands.sh",d,e)}}function proofreadAll(){var a=function(a){return validateNumericRange(a,1,16384)},b=function(a){return validateNumericRange(a,1,3600)},c=["max_connections","tcp_timeout","udp_timeout"],d=["max_connections_label","tcp_timeout_label","udp_timeout_label"];return proofreadFields(c,d,[a,b,b],[0,0,0],c)}function resetData(){document.getElementById("max_connections").value=maxConnections,document.getElementById("tcp_timeout").value=tcpTimeout,document.getElementById("udp_timeout").value=udpTimeout};