/*
 * This program is copyright ï¿½ 2008,2009 Eric Bishop and is distributed under the terms of the GNU GPL 
 * version 2.0 with a special clarification/exception that permits adapting the program to 
 * configure proprietary "back end" software provided that all modifications to the web interface
 * itself remain covered by the GPL. 
 * See http://gargoyle-router.com/faq.html#qfoss for more information
 */function doLogin(){var a=document.getElementById("password").value;if(a.length==0)alert("ERROR: You must enter a password");else{setControlsEnabled(!1,!0,"Logging In"),sessionExpired=!1,passInvalid=!1,loggedOut=!1;var b=getParameterDefinition("password",a),c=function(a){if(a.readyState==4){if(a.responseText.match(/^invalid/))passInvalid=!0,setStatusAndQuotas();else{var b=a.responseText.split(/[\n\r]+/),c=0;for(c=0;c<b.length;c++){var d=b[c].replace(/^.*ookie:/,"").replace(/\";.*$/,"");d.match(/=/)&&(document.cookie=d)}window.location.href=window.location.href}setControlsEnabled(!0)}};runAjax("POST","/utility/get_password_cookie.sh",b,c)}}function checkKey(a){var b=0;window.event?b=window.event.keyCode:a&&(b=a.which),b==13&&doLogin()}function setStatusAndQuotas(){setChildText("current_time_date",currentTime),sessionExpired?setChildText("login_status","Session Expired","red"):passInvalid?setChildText("login_status","Invalid Password","red"):loggedOut?setChildText("login_status","Logged Out","black"):setChildText("login_status","","black");var a=[],b=[],c=[],d;for(d=0;d<quotaIdList.length;d++){var e=quotaIdList[d],f=quotaIpLists[e];f.length>0&&(f[0]=="ALL"?a.push(e):f[0]=="ALL_OTHERS_COMBINED"?c.push(e):testAddrOverlap(connectedIp,f.join(","))&&(b.push(e),localIpName=connectedIp))}b=b.length==0?c:b;var g=["black",!1,"11px"],h=["red",!0,"12px"],i=[b,a],j=["local_quotas","global_quotas"],k;for(k=0;k<i.length;k++){var l=i[k],m=j[k],n=k==0?connectedIp:"ALL";clearFieldset(m);if(l.length>0){var o;for(o=0;o<l.length;o++){var p=l.length>1?o+1:-1,q=createQuotaDiv(l[o],n,p,g,h);document.getElementById(m).appendChild(q)}}document.getElementById(m).style.display=l.length>0?"block":"none"}}function clearFieldset(a){var b=document.getElementById(a);if(b!=null){var c=null;while(b.firstChild!=null){var d=b.firstChild;c=d.className=="sectionheader"?d:c,b.removeChild(d)}c!=null&&b.appendChild(c)}}function createQuotaDiv(a,b,c,d,e){var f="ALL_OTHERS_COMBINED",g=quotaIpLists[a],h=0;for(h=0;h<g.length;h++)f=testAddrOverlap(b,g[h])?g[h]:f;var i=quotaUsed[a][f],j=quotaPercents[a][f],k=quotaLimits[a][f],l=document.createElement("div");if(c>0){var m=document.createElement("span");m.style.fontSize=e[2],m.style.display="block",m.style.fontStyle="italic",m.style.textDecoration="underline",m.appendChild(document.createTextNode("Quota"+c+":")),l.appendChild(m);var n=timeParamsToLines(quotaTimes[a]),o=document.createElement("span"),p=document.createElement("span"),q=document.createElement("span");p.appendChild(document.createTextNode("Active "+(quotaTimes[a][3]=="only"?"Only:":"All Times Except:"))),p.style.fontSize=d[2],p.style.marginLeft="25px",p.style.display="block",p.style.width="150px",p.style.cssFloat="left",p.style.styleFloat="left",q.appendChild(document.createTextNode(n.shift())),q.style.fontSize=d[2],q.style.marginLeft="25px",q.style.display="inline",o.appendChild(p),o.appendChild(q),l.appendChild(o);while(n.length>0){var q=document.createElement("span");q.appendChild(document.createTextNode(n.shift())),q.style.fontSize=d[2],q.style.marginLeft="200px",q.style.display="block",p.style.clear="left",p.style.clear="left",l.appendChild(q)}}var r=["total up+down","download","upload"],s;for(s=0;s<3;s++)if(k[s]>=0){var t=r[s],u=parseBytes(k[s]),v=u.replace(/^.* /,""),w=parseBytes(i[s],v).replace(/ .*$/,""),x=truncateDecimal(j[s]);w=i[s]>k[s]?u.replace(/ .*$/,""):w;var y=document.createElement("span"),z=document.createElement("p");c>0?z.appendChild(document.createTextNode(x+"% of "+t+" for Quota"+c+" has been used ("+w+"/"+u+")")):z.appendChild(document.createTextNode(x+"% of "+t+" quota has been used ("+w+"/"+u+")"));var A=j[s]==100?e:d;z.style.color=A[0],z.style.fontWeight=A[1]?"bold":"normal",z.style.fontSize=A[2],y.appendChild(z),y.style.display="block",y.style.clear="left",c>0&&(y.style.marginLeft=c>0?"25px":"0px"),l.appendChild(y)}return l}function timeParamsToLines(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=[];return e=="always"?f.unshift("Always"):d!=""?f=d.match(",")?d.split(/[\t ]*,[\t ]*/):[d]:(b!=""&&(f=b.match(",")?b.split(/[\t ]*,[\t ]*/):[b]),c!=""&&f.unshift(c)),f};