/*
 * This program is copyright � 2008-2011 Eric Bishop and is distributed under the terms of the GNU GPL 
 * version 2.0 with a special clarification/exception that permits adapting the program to 
 * configure proprietary "back end" software provided that all modifications to the web interface
 * itself remain covered by the GPL. 
 * See http://gargoyle-router.com/faq.html#qfoss for more information
 */function addLoadFunction(a){var b=window.onload;window.onload=typeof window.onload!="function"?a:function(){b(),a()}}function setControlsEnabled(a,b,c){var d=document.getElementById("darken"),e=document.getElementById("wait_msg");if(!a){var f="100%",g="100%";document.body.parentNode.scrollHeight?f=document.body.parentNode.scrollHeight+"px":document.height&&(f=document.height+"px"),document.body.parentNode.scrollWidth?(g=document.body.parentNode.scrollWidth,document.width&&(g=document.width>g?document.width:g),g+="px"):document.width&&(g=document.width+"px");var h,i;self.innerHeight?(h=window.innerHeight,viewportWidth=window.innerWidth):document.documentElement&&document.documentElement.clientHeight?(h=document.documentElement.clientHeight,viewportWidth=document.documentElement.clientWidth):document.body&&(h=document.body.clientHeight,viewportWidth=document.body.clientWidth);var j=Math.floor((viewportWidth-300)/2),k=Math.floor((h-150)/2),l=!1;document.all&&(l=!0);if(l){var m=document.getElementById("d_iframe");m.style.display="block",m.style.width=g,m.style.height=f;var n=document.getElementById("m_iframe");n.style.display="block",n.style.width="300px",n.style.height="150px",e.style.position="absolute",k+=document.documentElement.scrollTop,j+=document.documentElement.scrollLeft}d.style.height=f,d.style.width=g,e.style.left=j>=0?j+"px":"0px",e.style.top=k>=0?k+"px":"0px",d.style.display="block",b&&(e.style.display="block",c!=null&&(document.getElementById("wait_txt").firstChild.data=c))}else d.style.display="none",e.style.display="none";setBrowserTimeCookie()}function setBrowserTimeCookie(){var a=Math.floor((new Date).getTime()/1e3);document.cookie="browser_time="+a+"; path=/"}function getRequestObj(){var a;try{a=new XMLHttpRequest}catch(b){try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(b){try{a=new ActiveXObject("Microsoft.XMLHTTP")}catch(b){return!1}}}return a}function runAjax(a,b,c,d){setBrowserTimeCookie();var e=getRequestObj();return e&&(e.onreadystatechange=function(){d(e)},a=="POST"?(c=c==null?" ":c,e.open("POST",b,!0),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.send(c)):a=="GET"&&(e.open("GET",b+"?"+c,!0),e.send(null))),e}function UCIContainer(){this.keys=new Array,this.values=new Array,this.listOptions=new Array,this.createListOption=function(a,b,c,d){d=d==null?!0:!1;var e=a+"."+b+"."+c;if(this.listOptions[e]!=null)return;this.listOptions[e]=1;if(this.values[e]!=null){var f=this.values[e];this.values[e]=!d&&f!=null?[f]:[]}else this.keys.push(e),this.values[e]=[]},this.set=function(a,b,c,d,e){e=e==null?!1:e;var f=a+"."+b;c!=null&&c!=""&&(f=f+"."+c);if(this.values[f]!=null)if(this.listOptions[f]!=null){var g=this.values[f];while(g.length>0&&!e)g.pop();if(d instanceof Array){var h;for(h=0;h<d.length;h++)g.push(d[h])}else g.push(d);this.values[f]=g}else this.values[f]=d;else{this.keys.push(f);if(this.listOptions[f]!=null){var g=[];if(d instanceof Array){var i;for(i=0;i<d.length;i++)g.push(d[i])}else g=[d];this.values[f]=g}else this.values[f]=d}},this.get=function(a,b,c){var d=a+"."+b;c!=null&&c!=""&&(d=d+"."+c);var e=this.values[d];return e!=null?e:""},this.removeAllSectionsOfType=function(a,b){var c=this.getAllSectionsOfType(a,b),d=0;for(d=0;d<c.length;d++)this.removeSection(a,c[d])},this.getAllOptionsInSection=function(a,b,c){c=c==null?!1:c;var d=new Array;for(keyIndex in this.keys){var e=this.keys[keyIndex],f=a+"."+b;if(e.match(f)&&e.match(/^[^\.]+\.[^\.]+\.[^\.]+/)&&(c||this.listOptions[e]==null)){var g=e.match(/^[^\.]+\.[^\.]+\.([^\.]+)$/)[1];d.push(g)}}return d},this.getAllSectionsOfType=function(a,b){var c=new Array;for(keyIndex in this.keys){key=this.keys[keyIndex];if(key.match(a)&&key.match(/^[^\.]+\.[^\.]+$/)&&this.values[key]==b){var d=key.match(/^[^\.]+\.([^\.]+)$/)[1];c.push(d)}}return c},this.getAllSections=function(a){var b=new Array;for(keyIndex in this.keys){key=this.keys[keyIndex];if(key.match(a)&&key.match(/^[^\.]+\.[^\.]+$/)){var c=key.match(/^[^\.]+\.([^\.]+)$/)[1];b.push(c)}}return b},this.remove=function(a,b,c){var d=a+"."+b;c!=""&&(d=d+"."+c),this.listOptions[d]!=null&&(this.listOptions[d]=null);var e=this.values[d];if(e!=null){this.values[d]=null;var f=[];while(this.keys.length>0){var g=this.keys.shift();g!=d&&f.push(g)}this.keys=f}else e="";return e},this.removeSection=function(a,b){removeKeys=new Array,sectionDefined=!1;for(keyIndex in this.keys){key=this.keys[keyIndex],testExp=new RegExp(a+"\\."+b+"\\.");if(key.match(testExp)){var c=key.split(".");removeKeys.push(c[2])}key==a+"."+b&&(sectionDefined=!0)}for(rkIndex in removeKeys)this.remove(a,b,removeKeys[rkIndex]);sectionDefined&&this.remove(a,b,"")},this.clone=function(){var a=new UCIContainer,b=0;for(b=0;b<this.keys.length;b++){var c=this.keys[b],d=this.values[c];this.listOptions[c]!=null&&(a.listOptions[c]=1);var e=c.match(/^([^\.]+)\.([^\.]+)\.([^\.]+)$/);e==null&&(e=c.match(/^([^\.]+)\.([^\.]+)$/),e!=null&&e.push("")),a.set(e[1],e[2],e[3],d,!0)}return a},this.print=function(){var a="",b=0;for(b=0;b<this.keys.length;b++){var c=this.keys[b];this.values[c]instanceof Array?a=a+"\n"+c+' = "'+this.values[c].join(",")+'"':a=a+"\n"+c+' = "'+this.values[c]+'"'}return a},this.getScriptCommands=function(a){var b=new Array,c=[],d=0;for(d=0;d<a.keys.length;d++){var e=a.keys[d],f=a.values[e],g=this.values[e];if(f instanceof Array&&!(g instanceof Array)||g instanceof Array&&!(f instanceof Array))b.push("uci del "+e);else if(f instanceof Array&&g instanceof Array){var h=f.length==g.length;if(h){var i=f.sort(),j=g.sort(),k;for(k=0;h&&k<i.length;k++)h=i[k]==j[k]?!0:!1}h?c[e]=1:b.push("uci del "+e)}else(g==null||g=="")&&f!=null&&f!=""&&b.push("uci del "+e)}for(d=0;d<this.keys.length;d++){var e=this.keys[d],f=a.values[e],g=this.values[e];try{if(f instanceof Array||g instanceof Array)if(g instanceof Array){if(c[e]==null){var l;for(l=0;l<g.length;l++){var m=""+g[l]+"";b.push("uci add_list "+e+"='"+m.replace(/'/,"'\\''")+"'")}}}else g=""+g+"",b.push("uci set "+e+"='"+g.replace(/'/,"'\\''")+"'");else f!=g&&g!=null&&g!=""&&(g=""+g+"",b.push("uci set "+e+"='"+g.replace(/'/,"'\\''")+"'"))}catch(n){alert("bad key = "+e+"\n")}}return b.push("uci commit"),b.join("\n")}}function getParameterDefinition(a,b){return fullEscape(a)+"="+fullEscape(b)}function fullEscape(a){a=escape(a);var b=["*","@","-","_","+",".","/"],c=["2A","40","2D","5F","2B","2E","2F"];for(oeIndex=0;oeIndex<b.length;oeIndex++){var d=a.split(b[oeIndex]);d.length>1&&(a=d.join("%"+c[oeIndex]))}return a}function removeStringFromArray(a,b){var c,d=[];for(c=0;c<a.length;c++){var e=!1;typeof a[c]=="string"&&(e=a[c]==b),e||d.push(a[c])}return d}function setChildText(a,b,c,d,e,f){f=f==null?document:f,parentElement=f.getElementById(a);if(parentElement!=null){c!=null&&(parentElement.style.color=c),d!=null&&(parentElement.style.fontWeight=d?"bold":"normal"),e!=null&&(parentElement.style.fontSize=e);while(parentElement.firstChild!=null)parentElement.removeChild(parentElement.firstChild);b=b==null?"":b;var g=b.split("\n");while(g.length>0){var h=g.shift();parentElement.appendChild(f.createTextNode(h)),g.length>0&&parentElement.appendChild(f.createElement("br"))}}}function createInput(a,b){b=b==null?document:b;try{inp=b.createElement("input"),inp.type=a}catch(c){inp=b.createElement('<input type="'+a+'" />')}return inp}function trueAndVisible(a,b){return document.getElementById(a).checked&&document.getElementById(b).style.display!="none"}function getDhcpSection(a){var b=a.getAllSections("dhcp"),c=b.length>0?b[0]:"cfg1";for(dsecIndex=0;dsecIndex<b.length;dsecIndex++)a.get("dhcp",b[dsecIndex],"interface")=="lan"&&(c=b[dsecIndex]);return c}function getWirelessMode(a){var b=a.getAllSectionsOfType("wireless","wifi-device"),c=[],d;for(d=0;d<b.length;d++){var e=a.get("wireless",b[d],"disabled");if(e=="0"||e=="")c[b[d]]=1}var f="",g="",h=a.getAllSectionsOfType("wireless","wifi-iface"),i;for(i=0;i<h.length;i++){var j=a.get("wireless",h[i],"device");if(c[j]==1){var k=a.get("wireless",h[i],"mode");f=k=="ap"?k:f,g=k=="ap"?a.get("wireless",h[i],"wds")?"wds":g:k}}var l=f!=""&&g!=""?"+":"",m=f+l+g,m=m==""?"disabled":m;return m}function setDescriptionVisibility(a,b,c,d){b=b==null?"inline":b,c=c==null?"More Info":c,d=d==null?"Hide Text":d;var e=document.getElementById(a+"_ref"),f=document.getElementById(a+"_txt"),g="uci set gargoyle.help."+a+"=";e.firstChild.data==c?(f.style.display=b,e.firstChild.data=d,g+="1\n"):(f.style.display="none",e.firstChild.data=c,g+="0\n"),g+="\nuci commit\n";var h=getParameterDefinition("commands",g)+"&"+getParameterDefinition("hash",document.cookie.replace(/^.*hash=/,"").replace(/[\t ;]+.*$/,""));runAjax("POST","utility/run_commands.sh",h,function(){return 0})}function initializeDescriptionVisibility(a,b,c,d,e){c=c==null?"inline":c,d=d==null?"More Info":d,e=e==null?"Hide Text":e;var f=d,g="none";a.get("gargoyle","help",b)=="1"&&(f=e,g=c),document.getElementById(b+"_ref").firstChild.data=f,document.getElementById(b+"_txt").style.display=g}function getSubnetRange(a,b){var c=a.split(".");if(c.length!=4)return[];var d=["255","254","252","248","240","224","192","128","0"],e=[0,1,2,3,4,5,6,7,8],f=0;while(c.length>0){var g=c.shift(),h=-1;for(testIndex=0;testIndex<9&&h<0;testIndex++)h=d[testIndex]==g?e[testIndex]:h;if(h<0)return[];f+=h}var i=Math.pow(2,f),j=parseInt(b.split(".")[3]),k=0;while(k+i<j)k+=i;return[k,k+i-1]}function rangeInSubnet(a,b,c,d){var e=getSubnetRange(a,b),f=e[0],g=e[1];return f!=null&&g!=null&&f<=c&&g>=d?!0:!1}function proofreadFields(a,b,c,d,e,g){g=g==null?document:g;var h=new Array;for(idIndex in a)isVisible=!0,e!=null&&e[idIndex]!=null&&(visibilityElement=g.getElementById(e[idIndex]),isVisible=visibilityElement.style.display=="none"||visibilityElement.disabled==1?!1:!0),isVisible&&(input=g.getElementById(a[idIndex]),f=c[idIndex],proofreadText(input,f,d[idIndex]),f(input.value)!=d[idIndex]&&(labelStr=b[idIndex]+"",g.getElementById(b[idIndex])!=null?(labelStr=g.getElementById(b[idIndex]).firstChild.data,labelStr=labelStr.replace(/:/,"")):alert("error in proofread: label with id "+b[idIndex]+" is not defined"),h.push("There is an error in "+labelStr)));return h}function parseBytes(a,b){var c;return b=b!="KBytes"&&b!="MBytes"&&b!="GBytes"&&b!="TBytes"?"mixed":b,b=="mixed"&&a>1099511627776||b=="TBytes"?c=truncateDecimal(a/1099511627776)+" TBytes":b=="mixed"&&a>1073741824||b=="GBytes"?c=truncateDecimal(a/1073741824)+" GBytes":b=="mixed"&&a>1048576||b=="MBytes"?c=truncateDecimal(a/1048576)+" MBytes":c=truncateDecimal(a/1024)+" KBytes",c}function parseKbytesPerSecond(a,b){var c;return b=b!="bytes/s"&&b!="KBytes/s"&&b!="MBytes/s"?"mixed":b,b=="mixed"&&a>1024||b=="MBytes/s"?c=truncateDecimal(a/1024)+" MBytes/s":c=a+" KBytes/s",c}function truncateDecimal(a){return result=""+Math.floor(a*1e3)/1e3,decMatch=result.match(/.*\.(.*)$/),decMatch==null?result+=".000":decMatch[1].length==1?result+="00":decMatch[1].length==2&&(result+="0"),result}function enableAssociatedField(a,b,c,d){d=d==null?document:d,element=d.getElementById(b),setElementEnabled(element,a.checked,c)}function setElementEnabled(a,b,c){if(b){a.readonly=!1,a.disabled=!1;if(a.type=="text"||a.type=="textarea")a.style.color="#000000",a.className="";else if(a.type=="select-one"||a.type=="select-multiple"||a.type=="select")a.className="";else if(a.type=="button"){var d=a.className.replace(/_button.*$/,"_button");a.className=d}}else{a.disabled=!0;if(a.type=="text"||a.type=="textarea")a.value=c,a.style.color="#AAAAAA",a.className="text_disabled";else if(a.type=="select-one"||a.type=="select-multiple"||a.type=="select")setSelectedValue(a.id,c,a.ownerDocument),a.className="select_disabled";else if(a.type=="button"){var d=a.className.replace(/_button.*$/,"_button");a.className=d+"_disabled"}else a.type=="file"&&(a.value=c)}}function getSelectedValue(a,b){b=b==null?document:b;if(b.getElementById(a)==null){alert("ERROR:"+a+" does not exist");return}return selectedIndex=b.getElementById(a).selectedIndex,selectedValue="",selectedIndex>=0&&(selectedValue=b.getElementById(a).options[b.getElementById(a).selectedIndex].value),selectedValue}function getSelectedText(a,b){return b=b==null?document:b,selectedIndex=b.getElementById(a).selectedIndex,selectedText="",selectedIndex>=0&&(selectedText=b.getElementById(a).options[b.getElementById(a).selectedIndex].text),selectedText}function setSelectedValue(a,b,c){var c=c==null?document:c,d=c.getElementById(a);d==null&&alert("ERROR: "+a+" does not exist");var e=!1;for(optionIndex=0;optionIndex<d.options.length&&!e;optionIndex++)e=d.options[optionIndex].value==b,e&&(d.selectedIndex=optionIndex);!e&&d.options.length>0&&d.selectedIndex<0&&(d.selectedIndex=0)}function setSelectedText(a,b,c){c=c==null?document:c,selectElement=c.getElementById(a),selectionFound=!1;for(optionIndex=0;optionIndex<selectElement.options.length&&!selectionFound;optionIndex++)selectionFound=selectElement.options[optionIndex].text==b,selectionFound&&(selectElement.selectedIndex=optionIndex);!selectionFound&&selectElement.options.length>0&&selectElement.selectedIndex<0&&(selectElement.selectedIndex=0)}function addOptionToSelectElement(a,b,c,d,e){e=e==null?document:e,option=e.createElement("option"),option.text=b,option.value=c;try{e.getElementById(a).add(option,d)}catch(f){d==null?e.getElementById(a).add(option):e.getElementById(a).add(option,d.index)}}function removeOptionFromSelectElement(a,b,c){c=c==null?document:c,selectElement=c.getElementById(a),selectionFound=!1;for(optionIndex=0;optionIndex<selectElement.options.length&&!selectionFound;optionIndex++)selectionFound=selectElement.options[optionIndex].text==b,selectionFound&&selectElement.remove(optionIndex)}function removeAllOptionsFromSelectElement(a){while(a.length>0)try{a.remove(0)}catch(b){}}function setAllowableSelections(a,b,c,d){d==null&&(d=document);var e=d.getElementById(a);if(c!=null&&b!=null&&e!=null){var f=!0;if(b.length==e.options.length){f=!1;for(optionIndex=0;optionIndex<e.options.length&&!f;optionIndex++)f=f||e.options[optionIndex].text!=c[optionIndex]||e.options[optionIndex].value!=b[optionIndex]}if(f){currentSelection=getSelectedValue(a,d),removeAllOptionsFromSelectElement(e);for(addIndex=0;addIndex<b.length;addIndex++)addOptionToSelectElement(a,c[addIndex],b[addIndex],null,d);setSelectedValue(a,currentSelection,d)}}}function setSingleChild(a,b){while(a.firstChild!=null)a.removeChild(a.firstChild);a.appendChild(b)}function setVariableFromValue(a){elementId=a[0],visibilityId=a[1],uci=a[2],pkg=a[3],section=a[4],option=a[5],setIfBlank=a[6];var b=!0;visibilityId!=null&&(b=document.getElementById(visibilityId).style.display=="none"?!1:!0),b==1&&(value=document.getElementById(elementId).value,(value!=""||setIfBlank==1)&&uci.set(pkg,section,option,value))}function setVariableFromModifiedValue(a){elementId=a[0],visibilityId=a[1],uci=a[2],pkg=a[3],section=a[4],option=a[5],setIfBlank=a[6],modFunction=a[7],isVisible=!0,visibilityId!=null&&(isVisible=document.getElementById(visibilityId).style.display=="none"?!1:!0),isVisible==1&&(value=document.getElementById(elementId).value,(value!=""||setIfBlank==1)&&uci.set(pkg,section,option,modFunction(value)))}function setVariableFromCombined(a){elementIds=a[0],visibilityId=a[1],uci=a[2],pkg=a[3],section=a[4],option=a[5],setIfBlank=a[6],combineFunction=a[7],isVisible=!0,visibilityId!=null&&(isVisible=document.getElementById(visibilityId).style.display=="none"?!1:!0);if(isVisible==1){values=new Array;for(idIndex in elementIds)values.push(document.getElementById(elementIds[idIndex]).value);(value!=""||setIfBlank==1)&&uci.set(pkg,section,option,combineFunction(values))}}function setVariableFromConcatenation(a){elementIds=a[0],visibilityIds=a[1],uci=a[2],pkg=a[3],section=a[4],option=a[5],setIfBlank=a[6],concat="",nextIdIndex=0;while(nextIdIndex<elementIds.length)idVisible=!0,visibilityIds!=null&&(nextVisId=visibilityIds[nextIdIndex],nextVisId!=null&&(idVisible=document.getElementById(nextVisId).style.display=="none"?!1:!0)),value=document.getElementById(elementIds[nextIdIndex]).value,idVisible==1&&value!=""&&(value=document.getElementById(elementIds[nextIdIndex]).value,endSpace=nextIdIndex<elementIds.length-1?" ":"",concat=concat+value+endSpace),nextIdIndex++;(concat!=""||setIfBlank==1)&&uci.set(pkg,section,option,concat)}function setVariableConditionally(a){elementId=a[0],visibilityId=a[1],uci=a[2],pkg=a[3],section=a[4],option=a[5],testFunction=a[6],useValueFromElement=a[7],alternateValue=a[8],isVisible=!0,visibilityId!=null&&(isVisible=document.getElementById(visibilityId).style.display=="none"?!1:!0),isVisible==1&&(value=useValueFromElement==1?document.getElementById(elementId).value:alternateValue,testFunction(value)&&uci.set(pkg,section,option,value))}function setVariables(a,b,c,d,e,f,g,h){for(idIndex in a){nextId=a[idIndex],nextVisibilityId=b[idIndex],nextPkg=d[idIndex],nextSection=e[idIndex],nextOption=f[idIndex],nextParams=h[idIndex],nextFunction=g[idIndex];if(isArray(nextParams)){fullList=[nextId,nextVisibilityId,c,nextPkg,nextSection,nextOption];for(pIndex in nextParams)fullList.push(nextParams[pIndex]);nextFunction(fullList)}else nextFunction([nextId,nextVisibilityId,c,nextPkg,nextSection,nextOption,nextParams])}}function loadSelectedValueFromVariable(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=c.get(d,e,f);h!=null&&h!=""?setSelectedValue(b,h):g!=null&&setSelectedValue(b,g)}function loadValueFromVariable(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=c.get(d,e,f),i=document.getElementById(b);h!=null&&h!=""?i.value=h:g!=null&&(i.value=g)}function loadValueFromVariableMultiple(a){var b=a[6];loadValueFromVariable(a);var c=document.getElementById(a[0]);c.value=c.value*b}function loadValueFromModifiedVariable(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=h(c.get(d,e,f)),j=document.getElementById(b);i!=null&&i!=""?j.value=i:g!=null&&(j.value=g)}function loadValueFromVariableAtIndex(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=c.get(d,e,f),j=i.split(/[,\t ]+/),k;h<j.length?k=j[h]:k="";var l=document.getElementById(b);k!=null&&k!=""?l.value=k:g!=null&&(l.value=g)}function loadChecked(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5];document.getElementById(a[0]).checked=g(c.get(d,e,f))}function isArray(a){return a.constructor.toString().indexOf("Array")>=0||a instanceof Array?!0:!1}function loadVariables(a,b,c,d,e,f,g){for(idIndex in b){nextId=b[idIndex],nextPkg=c[idIndex],nextSection=d[idIndex],nextOption=e[idIndex],nextParams=f[idIndex],nextFunc=g[idIndex];if(isArray(nextParams)){fullList=[nextId,a,nextPkg,nextSection,nextOption];for(pIndex in nextParams)fullList.push(nextParams[pIndex]);nextFunc(fullList)}else nextFunc([nextId,a,nextPkg,nextSection,nextOption,nextParams])}}function loadValueFromMultipleVariables(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=new Array;for(pkgIndex in d)i.push(c.get(d[pkgIndex],e[pkgIndex],f[pkgIndex]));var j=g(i),k=document.getElementById(b);j!=null&&j!=""?k.value=j:h!=null&&(k.value=h)}function setVisibility(a,b,c,d){d==null&&(d=document);for(index in a)element=d.getElementById(a[index]),b[index]==0?element.style.display="none":c?element.style.display=c[index]:element.style.display="block"}function validateIP(a){var b=0;if(a=="0.0.0.0")b=1;else if(a=="255.255.255.255")b=2;else{var c=a.match(/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/);if(c==null)b=5;else for(field=1;field<=4;field++)c[field]>255&&(b=4),c[field]==255&&field==4&&(b=3)}return b}function validateMac(a){var b=0,c=a.split(/:/);if(c.length!=6)b=2;else for(fieldIndex=0;fieldIndex<6&&b==0;fieldIndex++)field=c[fieldIndex],field.match(/^[0123456789ABCDEFabcdef]{2}$/)==null&&(b=1);return b}function validateMultipleIps(a){a=a.replace(/^[\t ]+/g,""),a=a.replace(/[\t ]+$/g,"");var b=a.split(/[\t ]*,[\t ]*/),c=b.length>0?0:1;while(c==0&&b.length>0){var d=b.pop();if(d.match(/-/)){var e=d.split(/[\t ]*-[\t ]*/);if(e.length==2&&validateIP(e[0])==0&&validateIP(e[1])==0){var f=getIpInteger(e[0]),g=getIpInteger(e[1]);c=f<=g?0:1}else c=1}else c=validateIpRange(d)}return c}function validateMultipleIpsOrMacs(a){var b=a.replace(/^[\t ]+/g,"");b=b.replace(/[\t ]+$/g,"");var c=b.split(/[\t ]*,[\t ]*/),d=c.length>0?0:1;while(d==0&&c.length>0){var e=c.pop();if(e.match(/-/)){var f=e.split(/[\t ]*-[\t ]*/);if(f.length==2&&validateIP(f[0])==0&&validateIP(f[1])==0){var g=getIpInt(f[0]),h=getIpInt(f[1]);d=g<=h?0:1}else d=1}else e.match(/:/)?d=validateMac(e):d=validateIpRange(e)}return d}function validateDecimal(a){var b=a.match(/^[\d]*\.?[\d]+$/)!=null||a.match(/^[\d]+\.?[\d]*$/)!=null?0:1;return b}function validateNumeric(a){var b=a.match(/^[\d]+$/)==null?1:0;return b}function validatePort(a){return validateNumericRange(a,1,65535)}function validateNumericRange(a,b,c){var d=a.match(/^[\d]+$/)==null?1:0;return d==0&&(d=a<b?2:0),d==0&&(d=a>c?3:0),d}function validatePortOrPortRange(a){var b=0;if(a.match(/-/)!=null){var c=a.split(/-/);c.length>2?b=5:(error1=validateNumericRange(c[0],1,65535),error2=validateNumericRange(c[1],1,65535),b=error1+10*error2,b==0&&(b=c[1]-c[0]>=0?0:4))}else b=validateNumericRange(a,1,65535);return b}function validateNetMask(a){var b=0,c=a.match(/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/);if(c==null)b=4;else{previousField=255;for(field=1;field<=4;field++)c[field]>255&&(b=3),previousField<255&&c[field]!=0&&b<2&&(b=2),c[field]!=255&&c[field]!=254&&c[field]!=252&&c[field]!=248&&c[field]!=240&&c[field]!=224&&c[field]!=192&&c[field]!=128&&c[field]!=0&&b<1&&(b=1),previousField=c[field]}return b}function validateIpRange(a){var b=1;if(a.indexOf("/")>0){var c=a.split("/");if(c.length==2){var d=validateIP(c[0]),e=validateNetMask(c[1])==0||validateNumericRange(c[1],1,31)==0?0:1;b=d==0&&e==0?0:1}}else b=validateIP(a);return b}function validateLengthRange(a,b,c){var d=0;return a.length<b&&(d=1),a.length>c&&(d=2),d}function validateHex(a){var b=0;return a.match(/^[0123456789AaBbCcDdEeFf]*$/)||(b=1),b}function validateHours(a){var b=a.match(/,/)?a.split(/,/):[a],c=!0;for(commaIndex=0;commaIndex<b.length&&c;commaIndex++){var d=b[commaIndex].split(/-/),e=d.length==2;e&&(e=e&&d[0].match(/^[\t ]*([0-1]?[0-9]|2[0-3])(:[0-5][0-9])?[\t ]*$/),e=e&&d[1].match(/^[\t ]*([0-1]?[0-9]|2[0-3])(:[0-5][0-9])?[\t ]*$/)),c=c&&e}return c?0:1}function validateWeeklyRange(a){var b=a.match(/,/)?a.split(/,/):[a],c=!0;for(commaIndex=0;commaIndex<b.length&&c;commaIndex++){var d=b[commaIndex].split(/-/),e=d.length==2;e&&(d[0]=d[0].toLowerCase(),d[1]=d[1].toLowerCase(),e=e&&d[0].match(/^[\t ]*(sun|mon|tue|wed|thu|fri|sat)[\t ]*([0-1]?[0-9]|2[0-3])(:[0-5]?[0-9])?(:[0-5]?[0-9])?[\t ]*$/),e=e&&d[1].match(/^[\t ]*(sun|mon|tue|wed|thu|fri|sat)[\t ]*([0-1]?[0-9]|2[0-3])(:[0-5]?[0-9])?(:[0-5]?[0-9])?[\t ]*$/)),c=c&&e}return c?0:1}function proofreadHours(a){proofreadText(a,validateHours,0)}function proofreadWeeklyRange(a){proofreadText(a,validateWeeklyRange,0)}function proofreadLengthRange(a,b,c){var d=function(a){return validateLengthRange(a,b,c)};proofreadText(a,d,0)}function proofreadIp(a){proofreadText(a,validateIP,0)}function proofreadMask(a){proofreadText(a,validateNetMask,0)}function proofreadIpRange(a){proofreadText(a,validateIpRange,0)}function proofreadMac(a){proofreadText(a,validateMac,0)}function proofreadMultipleIps(a){proofreadText(a,validateMultipleIps,0)}function proofreadMultipleIpsOrMacs(a){proofreadText(a,validateMultipleIpsOrMacs,0)}function proofreadDecimal(a){proofreadText(a,validateDecimal,0)}function proofreadNumeric(a){proofreadText(a,validateNumeric,0)}function proofreadNumericRange(a,b,c){proofreadText(a,function(a){return validateNumericRange(a,b,c)},0)}function proofreadPort(a){proofreadText(a,validatePort,0)}function proofreadPortOrPortRange(a){proofreadText(a,validatePortOrPortRange,0)}function proofreadText(a,b,c){a.disabled!=1&&(a.style.color=b(a.value)==c?"black":"red")}function getEmbeddedSvgWindow(a,b){b==null&&(b=document);var c=b.getElementById(a),d=null;try{var e=c.getSVGDocument();d=e.defaultView}catch(f){}if(d==null){try{d=c.window}catch(g){}if(d==null)try{d=c.getWindow()}catch(h){}}return d}function getBridgeSection(a){var b=uciOriginal.getAllSections("wireless"),c=uciOriginal.get("network","wan",""),d="",e;for(e=0;e<b.length&&d=="";e++){var f=function(c){return a.get("wireless",b[e],c).toLowerCase()};f("mode")=="wds"&&c==""?d=b[e]:f("mode")=="sta"&&f("wds")=="1"&&c==""?d=b[e]:f("mode")=="sta"&&f("client_bridge")=="1"&&(d=b[e])}return d}function isBridge(a){var b=getBridgeSection(a)==""?!1:!0;return b}function parseTimezones(a){timezoneList=[],timezoneRegions=[],timezoneDefinitions=[],definitionTimezones=[];for(lineIndex=0;lineIndex<a.length;lineIndex++)line=a[lineIndex],!line.match(/^[\t ]*#/)&&line.length>0&&(splitLine=line.split(/[\t]+/),region=stripQuotes(splitLine.pop()),definition=stripQuotes(splitLine.pop()),timezone=stripQuotes(splitLine.pop()),timezoneList.push(timezone),timezoneDefinitions[timezone]=definition,definitionTimezones[definition]=timezone,timezoneRegions[timezone]=region);return[timezoneList,timezoneRegions,timezoneDefinitions,definitionTimezones]}function stripQuotes(a){return a.match(/\".*\"/)&&(a=a.match(/^[^\"]*\"([^\"]*)\"/)[1]),a}function textListToSpanElement(a,b,c){b=b==null?!1:b,c=c==null?document:c;var d=c.createElement("span"),e;for(e=0;e<a.length;e++)e>0&&d.appendChild(c.createElement("br")),d.appendChild(c.createTextNode(a[e]+(e<a.length-1&&b?",":"")));return d}function addAddressStringToTable(a,b,c,d,e,f,g,h){e=e==null?!0:!1,f=f==null?3:f;var i;f==0?i=function(){return 1}:f==1?i=validateIP:f==2?i=validateIpRange:i=validateMultipleIps;var j=[],k=[],l=a.getElementById(c);if(l.firstChild!=null){var m=l.firstChild,n=getTableDataArray(m,!0,!1),o;for(o=0;o<n.length;o++){var p=n[o][0];validateMac(p)==0?j.push(p):k.push(p)}}a=a==null?document:a,g=g==null?!0:g;var q=b.split(/[\t ]*,[\t ]*/),r=q.length>0?0:1,s;for(s=0;s<q.length&&r==0;s++){var p=q[s],t=e&&validateMac(p)==0,u=i(p)==0;if(t||u){var v=t?j:k;r=v.length==0||!testAddrOverlap(p,v.join(","))?0:1,r==0&&v.push(p)}else r=1}if(r==0){var m=l.childNodes.length>0?l.firstChild:createTable([""],[],d,!0,!1,null,null,a);b=b.replace(/^[\t ]*/,""),b=b.replace(/[\t ]*$/,"");var w=b.split(/[\t ]*,[\t ]*/);while(w.length>0)addTableRow(m,[w.shift()],!0,!1,null,null,a);l.childNodes.length==0&&l.appendChild(m),h!=null&&(m.style.width=""+h+"px")}else g&&alert("ERROR: Invalid Address\n");return r==0?!0:!1}function addAddressesToTable(a,b,c,d,e,f,g,h){var i=a.getElementById(b).value,j=addAddressStringToTable(a,i,c,d,e,f,g,h);return j&&(a.getElementById(b).value=""),j}function parsePaddedInt(a){a=a==null?"":a,a=a.replace(/[\t ]+/,"");while(a.length>1&&a.match(/^0/)||a.length>2&&a.match(/^\-0/))a=a.replace(/^0/,""),a=a.replace(/^\-0/,"-");return parseInt(a)}function getIpInteger(a){a=a==null?"":a;var b=a.match(/^(\d+)\.(\d+)\.(\d+)\.(\d+)$/);return b?(+parsePaddedInt(b[1])<<24)+(+parsePaddedInt(b[2])<<16)+(+parsePaddedInt(b[3])<<8)+ +parsePaddedInt(b[4]):parseInt("")}function getMaskInteger(a){return-1<<32-parsePaddedInt(a)}function getIpRangeIntegers(a){var b=0,c=0;if(a.match(/\//)){var d=a.split(/[\t ]*\/[\t ]*/),e=getIpInteger(d[0]),f=d[1].match(/\./)?getIpInteger(d[1]):getMaskInteger(d[1]);b=e&f,c=b|~f}else if(a.match(/-/)){var d=a.split(/[\t ]*\-[\t ]*/);b=getIpInteger(d[0]),c=getIpInteger(d[1])}else b=getIpInteger(a),c=b;return[b,c]}function testSingleAddrOverlap(a,b){var c=function(a){a=a==""?"ALL":a.toUpperCase();if(a=="ALL_OTHERS_COMBINED"||a=="ALL_OTHERS_INDIVIDUAL")a="ALL_OTHERS_COMBINED";return a};a=c(a),b=c(b);var d=!1;if(a==b)d=!0;else if(validateMultipleIps(a)>0||validateMultipleIps(b)>0||a.match(",")||b.match(","))d=!1;else{var e=getIpRangeIntegers(a),f=getIpRangeIntegers(b);d=e[0]<=f[1]&&e[1]>=f[0]}return d}function testAddrOverlap(a,b){a=a.replace(/^[\t ]+/,""),a=a.replace(/[\t ]+$/,""),b=b.replace(/^[\t ]+/,""),b=b.replace(/[\t ]+$/,"");var c=a.split(/[,\t ]+/),d=b.split(/[,\t ]+/),e,f=!1;for(e=0;e<c.length&&!f;e++){var g;for(g=0;g<d.length&&!f;g++)f=f||testSingleAddrOverlap(c[e],d[g])}return f}function setInvisibleIfIdMatches(a,b,c,d,e){e=e==null?document:e,d=d==null?"block":d;var f=e.getElementById(c),g=!1,h=0;if(f!=null){for(h=0;h<b.length;h++)g=getSelectedValue(a,e)==b[h]?!0:g;g?f.style.display="none":f.style.display=d}}function arrToHash(a){var b=[],c;for(c=0;c<a.length;c++)b[a[c]]=1;return b}function confirmPassword(a,b,c){a=a==null?"Confirm Password:":a;if(typeof confirmWindow!="undefined")try{confirmWindow.close()}catch(d){}try{xCoor=window.screenX+225,yCoor=window.screenY+225}catch(d){xCoor=window.left+225,yCoor=window.top+225}var e="password_confirm.sh";confirmWindow=window.open(e,"password","width=560,height=260,left="+xCoor+",top="+yCoor);var f=createInput("button",confirmWindow.document),g=createInput("button",confirmWindow.document);f.value="确定",f.className="default_button",g.value="取消",g.className="default_button",runOnEditorLoaded=function(){updateDone=!1,confirmWindow.document!=null&&confirmWindow.document.getElementById("bottom_button_container")!=null&&(confirmWindow.document.getElementById("bottom_button_container").appendChild(f),confirmWindow.document.getElementById("bottom_button_container").appendChild(g),setChildText("confirm_text",a,null,null,null,confirmWindow.document),g.onclick=function(){confirmWindow.close()},f.onclick=function(){setControlsEnabled(!1,!0,"Verifying Password...");var a='gargoyle_session_validator -p "'+confirmWindow.document.getElementById("password").value+'" -a "dummy.browser" -i "127.0.0.1"',d=getParameterDefinition("commands",a)+"&"+getParameterDefinition("hash",document.cookie.replace(/^.*hash=/,"").replace(/[\t ;]+.*$/,"")),e=function(a){if(a.readyState==4){confirmWindow.close();var d=a.responseText.split("\n")[0];d.match(/^echo \"invalid\"/)?c.call(null):b.call(null)}};runAjax("POST","utility/run_commands.sh",d,e)},confirmWindow.moveTo(xCoor,yCoor),confirmWindow.focus(),updateDone=!0),updateDone||setTimeout("runOnEditorLoaded()",250)},runOnEditorLoaded()}function getUsedPorts(){var a=uciOriginal.getAllSections("dropbear"),b=uciOriginal.get("dropbear",a[0],"Port"),c=uciOriginal.get("httpd_gargoyle","server","http_port"),d=uciOriginal.get("httpd_gargoyle","server","https_port"),e=[];e.tcp=[],e.udp=[];var f=[];f.push([b,"tcp","SSH port"]),e.tcp[b]=1,c!=""&&(f.push([c,"tcp","web server port"]),e.tcp[c]=1),d!=""&&(f.push([d,"tcp","web server port"]),e.tcp[d]=1);var g=uciOriginal.getAllSectionsOfType("firewall","remote_accept"),h;for(h=0;h<g.length;h++){var i=g[h],j=uciOriginal.get("firewall",i,"local_port"),k=uciOriginal.get("firewall",i,"remote_port"),l=uciOriginal.get("firewall",i,"start_port"),m=uciOriginal.get("firewall",i,"end_port"),n=uciOriginal.get("firewall",i,"proto").toLowerCase(),o=uciOriginal.get("firewall",i,"zone").toLowerCase();if(o=="wan"||o==""){var p;k=k==""?j:k;for(p=0;p<f.length;p++)p[0]==j&&(p[1]==n||n==""||n=="tcpudp")&&localport!=k&&localport!=""&&(n==""||n=="tcpudp"?(f.push([k,"tcp",p[2]]),f.push([k,"udp",p[2]]),e.tcp[k]=1,e.udp[k]=1):(f.push([k,n,p[2]]),e[n][k]=1));if(j!=""){var q=n==""||n=="tcpudp"?["tcp","udp"]:[n];while(q.length>0){var r=q.shift();e[r][k]==null&&(f.push([k,r,"port redirected to router"]),e[r][k]=1,e[r][j]==null&&(f.push([j,r,"port in use by router"]),e[r][j]=1))}}if(j==""&&l!=""&&m!=""){var q=n==""||n=="tcpudp"?["tcp","udp"]:[n];while(q.length>0){var r=q.shift();f.push([l+"-"+m,r,"port redirected to router"])}}}}var s=uciOriginal.getAllSectionsOfType("firewall","redirect"),t;for(t=0;t<s.length;t++){var i=g[h],j=uciOriginal.get("firewall",i,"local_port"),k=uciOriginal.get("firewall",i,"remote_port"),n=uciOriginal.get("firewall",i,"proto").toLowerCase(),u=uciOriginal.get("firewall",i,"src").toLowerCase(),v=uciOriginal.get("firewall",i,"dest").toLowerCase(),w=uciOriginal.get("firewall",i,"src_dport"),x=uciOriginal.get("firewall",i,"dest_ip");f.push([k,n,"port forwarded to "+x])}return f}function checkForPortConflict(a,b,c){var d=null,e=null,f=!1;if(a.match(/-/)){var g=a.split(/-/);d=parseInt(g[0]),e=parseInt(g[1]),f=!0}else a=parseInt(a);if(c!=null){c.tcp=c["tcp"]==null?[]:c.tcp,c.udp=c["udp"]==null?[]:c.udp;if(c[b][a]!=null&&c[b][""+a]!=null)return"";var h;for(h in c[b])if(h.match(/-/)){var i=h.split(/-/);if(!f&&a>=parseInt(i[0])&&a<=parseInt(i[1]))return"";if(f&&d<=parseInt(i[1])&&e>=parseInt(i[0]))return""}}var j=getUsedPorts(),k,l="";for(k=0;k<j.length&&l=="";k++){var m=j[k];if(b==m[1]){var n=m[0];if(n.match(/\-/)){var g=
n.split(/\-/);!f&&a>=parseInt(g[0])&&a<=parseInt(g[1])&&(l=m[2]),f&&d<=parseInt(g[1])&&e>=parseInt(g[0])&&(l=m[2])}else!f&&a==parseInt(n)&&(l=m[2]),f&&parseInt(n)>=d&&parseInt(n)<=e&&(l=m[2])}}return l}function query(a,c,d,e){document.getElementById("wait_icon").style.display="none",document.getElementById("wait_txt").style.display="none",wmOldTxt=document.getElementById("wait_txt").style=="none"?!1:!0,wmOldBack=document.getElementById("wait_msg").style.background,wmOldWidth=document.getElementById("wait_msg").style.width,wmOldHeight=document.getElementById("wait_msg").style.height,wmOldTop=document.getElementById("wait_msg").style.top,document.getElementById("wait_msg").style.background="white",document.getElementById("wait_msg").style.width="585px",document.getElementById("wait_msg").style.height="500px",setControlsEnabled(!1,!1),document.getElementById("wait_msg").style.top="20px",queryFieldset=document.createElement("fieldset"),queryFieldset.innerHTML='<legend class="sectionheader" id="query_header">'+a+'</legend><div style="clear:both;display:block"><span class="nocolumn" id="query_text">'+c+'</span></div><div id="spacer_div" style="display:block; mrgin:8px;">&nbsp;</div><div id="query_button_container"></div>',document.getElementById("wait_msg").appendChild(queryFieldset);var f=[],g;for(g=0;g<d.length;g++)b=createInput("button",document),b.value=d[g],b.className="default_button",b.onclick=function(){document.getElementById("wait_msg").removeChild(queryFieldset),document.getElementById("wait_msg").style.background=wmOldBack,document.getElementById("wait_msg").style.width=wmOldWidth,document.getElementById("wait_msg").style.height=wmOldHeight,document.getElementById("wait_msg").style.top=wmOldTop,document.getElementById("wait_icon").style.display="block",document.getElementById("wait_txt").style.display="block",setControlsEnabled(!1,wmOldTxt),e(this.value)},document.getElementById("query_button_container").appendChild(b),document.getElementById("query_button_container").appendChild(document.createElement("br"))}window.onresize=function(){try{document.getElementById("darken").style.display=="block"&&setControlsEnabled(!1,document.getElementById("wait_msg").style.display=="block")}catch(b){}};